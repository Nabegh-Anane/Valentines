<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Will you be my Valentine? ‚ù§Ô∏è</title>

<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<text y='.9em' font-size='90'>‚ù§Ô∏è</text></svg>">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<style>
:root{
  --pink:#ff4d8d;
  --violet:#a855f7;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  display:grid;
  place-items:center;
  font-family:system-ui;
  background:linear-gradient(-45deg,#fde2e4,#fbcfe8,#f5d0fe,#fce7f3);
  background-size:400% 400%;
  animation:bg 14s infinite;
  overflow:hidden;
  padding:16px;
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.card{
  width:100%;
  max-width:420px;
  background:rgba(255,255,255,.6);
  backdrop-filter:blur(18px);
  padding:26px;
  border-radius:28px;
  text-align:center;
  z-index:2;
}
h1{
  font-size:clamp(22px,5vw,32px);
}
.button-zone{
  position:relative;
  width:100%;
  max-width:320px;
  height:160px;
  margin:0 auto;
}
button{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  padding:14px 22px;
  border-radius:999px;
  border:none;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
}
#yes{
  left:18%;
  background:linear-gradient(135deg,var(--pink),var(--violet));
  color:#fff;
  animation:pulse 2s infinite;
}
#no{
  left:60%;
  background:#fff;
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(255,77,141,.6)}
  70%{box-shadow:0 0 0 20px rgba(255,77,141,0)}
}
.floating-hearts{
  position:fixed;
  inset:0;
  pointer-events:none;
}
.heart{
  position:absolute;
  bottom:-20px;
  width:14px;height:14px;
  background:var(--pink);
  transform:rotate(45deg);
  animation:float 8s linear;
  opacity:.8;
}
.heart::before,.heart::after{
  content:"";
  position:absolute;
  width:14px;height:14px;
  background:inherit;
  border-radius:50%;
}
.heart::before{top:-7px}
.heart::after{left:-7px}
@keyframes float{
  to{transform:translateY(-110vh) rotate(45deg);opacity:0}
}
#result{
  display:none;
  margin-top:16px;
}
textarea{
  width:100%;
  min-height:80px;
  padding:12px;
  border-radius:14px;
  border:none;
  resize:none;
  font-size:14px;
}
#sendBtn{
  position:static;
  margin-top:12px;
  width:100%;
  background:linear-gradient(135deg,var(--pink),var(--violet));
  color:#fff;
}
.sent{
  margin-top:12px;
  font-weight:800;
  color:var(--pink);
}
</style>
</head>

<body>

<div class="floating-hearts"></div>

<div class="card">
  <h1>asma3ni üòå<br>will you be my valentine?</h1>

  <div class="button-zone" id="zone">
    <button id="yes">Eyh ‚ù§Ô∏è</button>
    <button id="no">L√© üòè</button>
  </div>

  <div id="result">
    <h2>oooooo mansada9ch üíñ</h2>
    <textarea id="comment" placeholder="Un petit mot üíå"></textarea>
    <button id="sendBtn">Envoyer üíò</button>
    <div id="sentMsg" class="sent" style="display:none">Message envoy√© üíò</div>
  </div>
</div>

<!-- Sons -->
<audio id="bgSound" src="https://assets.mixkit.co/active_storage/sfx/preview/mixkit-romantic-chime-2676.wav" autoplay loop></audio>
<audio id="yesSound" src="https://assets.mixkit.co/sfx/preview/mixkit-cartoon-bounce-2883.wav"></audio>

<script>
const API="https://vback-three.vercel.app/api/log";

// get name from URL
const urlParams = new URLSearchParams(window.location.search);
const visitorName = urlParams.get("name") || "Anonyme";

const visitorId=localStorage.getItem("vid")||crypto.randomUUID();
localStorage.setItem("vid",visitorId);

const trackerLink = window.location.href;

// detect device type simple
function deviceType(){
  const ua = navigator.userAgent;
  if(/iPhone/i.test(ua)) return "iPhone";
  if(/iPad/i.test(ua)) return "iPad";
  if(/Android/i.test(ua)) return "Android";
  if(/Mac/i.test(ua)) return "Mac";
  if(/Win/i.test(ua)) return "Windows PC";
  return "Autre";
}

function send(type,comment=""){
  fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      type,
      comment,
      visitorId,
      visitorName,
      ua: deviceType(),
      trackerLink
    })
  });
}

// visit
send("VISIT");

// no action
let clicked=false;
setTimeout(()=>{
  if(!clicked) send("NO_ACTION");
},15*60*1000);

// hearts
const hearts=document.querySelector(".floating-hearts");
setInterval(()=>{
  const h=document.createElement("div");
  h.className="heart";
  h.style.left=Math.random()*100+"vw";
  h.style.animationDuration=6+Math.random()*6+"s";
  hearts.appendChild(h);
  setTimeout(()=>h.remove(),12000);
},250);

// no flee
const no=document.getElementById("no");
document.getElementById("zone").addEventListener("pointermove",e=>{
  const r=no.getBoundingClientRect();
  if(Math.hypot(r.x-e.clientX,r.y-e.clientY)<120){
    no.style.left=Math.random()*70+"%";
    no.style.top=Math.random()*70+"%";
    document.getElementById("yesSound").play();
  }
});

// yes
let scale=1;
document.getElementById("yes").onclick=()=>{
  clicked=true;
  scale=Math.min(scale+0.25,4);
  yes.style.transform=`translateY(-50%) scale(${scale})`;
  document.getElementById("yesSound").play();
  confetti({particleCount:200,spread:120});
  send("YES_CLICK");
  document.getElementById("zone").style.display="none";
  document.getElementById("result").style.display="block";
};

// comment
document.getElementById("sendBtn").onclick=()=>{
  const c=document.getElementById("comment").value;
  if(!c.trim()) return;
  send("COMMENT",c);
  document.getElementById("sentMsg").style.display="block";
  document.getElementById("sendBtn").disabled=true;
};
</script>

</body>
</html>
