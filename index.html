<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ’˜ Valentine</title>

<!-- FAVICON â¤ï¸ -->
<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â¤ï¸</text></svg>">

<style>
* { box-sizing: border-box; font-family: "Poppins", system-ui; }
body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #ff4d8d, #ff9ac1);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}
.card {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  border-radius: 24px;
  padding: 24px;
  max-width: 420px;
  width: 100%;
  text-align: center;
}
img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid white;
}
h1 { margin: 16px 0 8px; }
p { opacity: .9; }

.buttons {
  display: flex;
  gap: 12px;
  margin-top: 20px;
}
button {
  flex: 1;
  padding: 14px;
  border-radius: 999px;
  border: none;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
}
.yes { background: #00e676; }
.no { background: #ff5252; color: white; }

textarea {
  width: 100%;
  margin-top: 14px;
  padding: 12px;
  border-radius: 16px;
  border: none;
  resize: none;
  font-size: 15px;
}

.send {
  margin-top: 10px;
  background: #ff4d8d;
  color: white;
}

h2 { margin-top: 14px; }

@media (max-width: 480px) {
  h1 { font-size: 22px; }
}
</style>
</head>

<body>
<div class="card">
  <img id="photo" src="" alt="photo">
  <h1 id="name"></h1>
  <p>Will you be my Valentine? ğŸŒ¹</p>

  <div class="buttons">
    <button class="yes" id="yesBtn">YES ğŸ˜ˆ</button>
    <button class="no" id="noBtn">NO ğŸ™ƒ</button>
  </div>

  <div id="afterYes"></div>
</div>

<!-- AUDIO INTERNET -->
<audio id="soundYes" src="https://assets.mixkit.co/active_storage/sfx/2762/2762-preview.mp3"></audio>
<audio id="soundPop" src="https://assets.mixkit.co/active_storage/sfx/2704/2704-preview.mp3"></audio>

<script>
/* ================= CONFIG ================= */
const API = "https://vback-three.vercel.app/api/log";

/* ======= DYNAMIC NAME & PHOTO ======= */
const params = new URLSearchParams(window.location.search);
const name = params.get("name") || "My Love ğŸ’–";
const photo = params.get("photo") || "https://i.imgur.com/6VBx3io.png";

document.getElementById("name").textContent = name;
document.getElementById("photo").src = photo;

/* ======= VISIT TRACKING ======= */
let visitId = localStorage.getItem("visitId");
if (!visitId) {
  visitId = crypto.randomUUID();
  localStorage.setItem("visitId", visitId);
}
send("VISIT");

/* ======= SEND FUNCTION ======= */
async function send(type, comment = "") {
  try {
    await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type,
        comment,
        ua: navigator.userAgent,
        visitId
      })
    });
  } catch (e) {}
}

/* ======= YES BUTTON ======= */
const yesBtn = document.getElementById("yesBtn");
const afterYes = document.getElementById("afterYes");

yesBtn.onclick = async () => {
  document.getElementById("soundYes").play().catch(()=>{});

  for (let i = 0; i < 100; i++) {
    document.getElementById("soundPop").play().catch(()=>{});
  }

  send("YES");

  afterYes.innerHTML = `
    <textarea id="comment" rows="3" placeholder="Un petit message ğŸ’Œ"></textarea>
    <button class="send" id="sendComment">Envoyer ğŸ’–</button>
  `;

  document.getElementById("sendComment").onclick = () => {
    const msg = document.getElementById("comment").value;
    send("COMMENT", msg);
    afterYes.innerHTML = "<h2>Message envoyÃ© ğŸ’˜</h2>";
  };
};

/* ======= NO BUTTON ======= */
document.getElementById("noBtn").onclick = () => {
  send("NO");
};
</script>
</body>
</html>
